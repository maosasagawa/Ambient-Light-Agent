# Ambient-Light-Agent

<div align="center">

**AI é©±åŠ¨çš„æ™ºèƒ½æ°›å›´ç¯æ§åˆ¶ç³»ç»Ÿ**

*è®©ç¯å…‰éšå¿ƒè€ŒåŠ¨ï¼Œè®©æ°›å›´éšè¨€è€Œç”Ÿ*

</div>

---

## é¡¹ç›®ç®€ä»‹

Ambient-Light-Agent æ˜¯ä¸€ä¸ªåŸºäº AI å¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½æ°›å›´ç¯æ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€æè¿°æˆ–è¯­éŸ³æŒ‡ä»¤ï¼Œè‡ªåŠ¨ç”Ÿæˆç¬¦åˆåœºæ™¯æ°›å›´çš„ç¯å…‰é…è‰²æ–¹æ¡ˆï¼Œå¹¶é©±åŠ¨ WS2812 RGB ç¯å¸¦å®ç°æ™ºèƒ½ç¯å…‰æ§åˆ¶ã€‚

### æ ¸å¿ƒç‰¹æ€§

-  **è¯­éŸ³äº¤äº’** - æ”¯æŒè¯­éŸ³è¾“å…¥ï¼Œé€šè¿‡ Whisper æ¨¡å‹å®æ—¶è½¬å½•
- **AI é…è‰²** - åŸºäº GPT æ¨¡å‹æ™ºèƒ½ç†è§£åœºæ™¯å¹¶ç”Ÿæˆä¸“ä¸šé…è‰²
-  **æ™ºèƒ½ç­›é€‰** - è‡ªåŠ¨è¿‡æ»¤ä½é¥±å’Œåº¦/ä½äº®åº¦è‰²å½©ï¼Œä¿è¯æ˜¾ç¤ºæ•ˆæœ
- **è‰²å½©ä¼˜åŒ–** - åŸºäºè‰²å½©è·ç¦»ç®—æ³•ç¡®ä¿é…è‰²å·®å¼‚æ€§
-  **ç§»åŠ¨ä¼˜å…ˆ** - å“åº”å¼è®¾è®¡,å®Œç¾é€‚é…æ‰‹æœºç«¯æ“ä½œ
-  **ç¡¬ä»¶é€‚é…** - æä¾› ESP32 ç­‰è®¾å¤‡ä¸“ç”¨ API æ¥å£
- **å†å²è®°å½•** - è‡ªåŠ¨ä¿å­˜ç”Ÿæˆè®°å½•,å¯å¿«é€Ÿå›æº¯

---

## æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯
- çº¯åŸç”Ÿ HTML5 + CSS3 + JavaScript
- Web Audio API (å®æ—¶éŸ³é¢‘åˆ†æ)
- MediaRecorder API (è·¨å¹³å°å½•éŸ³)
- è‡ªé€‚åº”å¸ƒå±€è®¾è®¡

### åç«¯æŠ€æœ¯
- PHP 7.4+ (æ— éœ€æ¡†æ¶ä¾èµ–)
- cURL (API è¯·æ±‚)
- JSON æ–‡ä»¶å­˜å‚¨

### AI æœåŠ¡
- **å¯¹è¯æ¨¡å‹**: GPT-4o-mini / GPT-3.5-turbo
- **è¯­éŸ³è¯†åˆ«**: Whisper Large V3
- **API æä¾›å•†**: å…¼å®¹ OpenAI æ ‡å‡†æ¥å£

### ç¡¬ä»¶æ”¯æŒ
- ESP32 ç³»åˆ—å¼€å‘æ¿
- WS2812/WS2812B RGB ç¯å¸¦
- ä»»æ„æ•°é‡ç¯ç  (ä»£ç å¯é…ç½®)

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```
PHP >= 7.4
cURL æ‰©å±•
æ–‡ä»¶å†™å…¥æƒé™
HTTPS ç¯å¢ƒ (è¯­éŸ³åŠŸèƒ½å¿…éœ€)
```

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/your-username/Ambient-Light-Agent.git
cd Ambient-Light-Agent
```

#### 2. é…ç½® API

ç¼–è¾‘ `index.php` ä¿®æ”¹ä»¥ä¸‹å¸¸é‡:

```php
define('API_KEY', 'your-api-key-here');          // æ›¿æ¢ä¸ºä½ çš„ API Key
define('BASE_URL_CHAT', 'https://api.openai.com/v1/chat/completions');
define('BASE_URL_AUDIO', 'https://api.openai.com/v1/audio/transcriptions');
define('MODEL_ID_CHAT', 'gpt-4o-mini');          // å¯é€‰: gpt-3.5-turbo
define('MODEL_ID_AUDIO', 'whisper-1');
```

#### 3. è®¾ç½®æƒé™

```bash
mkdir -p data
chmod 755 data
```

#### 4. éƒ¨ç½²è¿è¡Œ

**æ–¹å¼ A: PHP å†…ç½®æœåŠ¡å™¨ (æµ‹è¯•ç”¨)**
```bash
php -S 0.0.0.0:8080
```

**æ–¹å¼ B: Apache/Nginx (ç”Ÿäº§ç¯å¢ƒ)**

Apache é…ç½®ç¤ºä¾‹:
```apache
<VirtualHost *:443>
    ServerName ambient.yourdomain.com
    DocumentRoot /var/www/ambient-light
    
    SSLEngine on
    SSLCertificateFile /path/to/cert.pem
    SSLCertificateKeyFile /path/to/key.pem
    
    <Directory /var/www/ambient-light>
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

#### 5. è®¿é—®ç³»ç»Ÿ

æµè§ˆå™¨æ‰“å¼€: `https://your-domain.com` æˆ– `https://localhost:8080`

> âš ï¸ **é‡è¦**: è¯­éŸ³åŠŸèƒ½è¦æ±‚ HTTPS ç¯å¢ƒ (æµè§ˆå™¨å®‰å…¨ç­–ç•¥)

---

## ğŸ® ä½¿ç”¨æŒ‡å—

### Web ç•Œé¢æ“ä½œ

#### æ–¹å¼ 1: æ–‡å­—è¾“å…¥
1. åœ¨è¾“å…¥æ¡†è¾“å…¥åœºæ™¯æè¿°,ä¾‹å¦‚:
   - "æ·±å¤œç¼–ç¨‹"
   - "æµªæ¼«æ™šé¤"
   - "å¼€è½¦çŠ¯å›°,æé†’æˆ‘"
2. ç‚¹å‡»å‘é€æŒ‰é’® â¤
3. ç­‰å¾… AI ç”Ÿæˆé…è‰²æ–¹æ¡ˆ

#### æ–¹å¼ 2: è¯­éŸ³è¾“å…¥
1. ç‚¹å‡» ğŸ¤ éº¦å…‹é£æŒ‰é’®
2. è¯´å‡ºåœºæ™¯æè¿° (ä¸­æ–‡)
3. åœé¡¿ 1.5 ç§’è‡ªåŠ¨è¯†åˆ«å¹¶æäº¤
4. ç³»ç»Ÿè‡ªåŠ¨è½¬å½•å¹¶ç”Ÿæˆé…è‰²

### ESP32 ç¡¬ä»¶æ¥å…¥

---
---

## ğŸ”Œ API æ–‡æ¡£

### ESP32 è·å–é¢œè‰² API

**æ¥å£åœ°å€**
```
GET /index.php?api=esp32
```

**è¿”å›æ ¼å¼**
```json
[
  [0, 170, 255],
  [255, 100, 200],
  [50, 255, 150]
]
```

**è¿”å›è¯´æ˜**
- äºŒç»´æ•°ç»„æ ¼å¼
- æ¯ä¸ªå­æ•°ç»„ä»£è¡¨ä¸€ä¸ª RGB é¢œè‰² `[R, G, B]`
- å–å€¼èŒƒå›´: 0-255
- é»˜è®¤é¢œè‰²: `[[0, 170, 255]]` (å¤©è“è‰²)

**ä½¿ç”¨å»ºè®®**
- è½®è¯¢é—´éš”: 1-5 ç§’
- è¶…æ—¶å¤„ç†: å»ºè®®è®¾ç½® 5 ç§’è¶…æ—¶
- é”™è¯¯å¤„ç†: è¿”å›å¼‚å¸¸æ—¶ä½¿ç”¨ä¸Šæ¬¡çš„é¢œè‰²

---

## AI é…è‰²é€»è¾‘

### å†³ç­–å±‚çº§

ç³»ç»ŸæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§ç†è§£ç”¨æˆ·æ„å›¾:

1. **å®‰å…¨è‡³ä¸Š** 
   - å…³é”®è¯: "å›°"ã€"å¼€è½¦"ã€"å¿«"
   - è‡ªåŠ¨ç”Ÿæˆè­¦ç¤ºè‰² (çº¢/é»„)

2. **ç”¨æˆ·æ˜ç¡®æŒ‡å®š** 
   - ç¤ºä¾‹: "æˆ‘è¦è“è‰²"
   - ä¸¥æ ¼éµå¾ªç”¨æˆ·é¢œè‰²è¦æ±‚

3. **åœºæ™¯æ°›å›´æ¨æ–­** 
   - æ ¹æ®åœºæ™¯/æƒ…ç»ªç”Ÿæˆé…è‰²
   - ç¤ºä¾‹: "æµªæ¼«æ™šé¤" â†’ ç²‰çº¢/ç´«è‰²

### é¢œè‰²ç­›é€‰è§„åˆ™

ç³»ç»Ÿè‡ªåŠ¨è¿‡æ»¤ä»¥ä¸‹é¢œè‰²:

- âŒ **ä½äº®åº¦è‰²**: RGB æœ€å¤§å€¼ < 100
- âŒ **ä½é¥±å’Œåº¦è‰²**: é¥±å’Œåº¦ < 0.4
- âœ… **è‰²å½©å·®å¼‚æ€§**: é€‰ä¸­é¢œè‰²çš„æ¬§æ°è·ç¦» > 80

### Prompt å·¥ç¨‹

æ ¸å¿ƒ Prompt ä½äº `get_llm_prompt()` å‡½æ•°,å¯æ ¹æ®éœ€æ±‚è°ƒæ•´:

```php
function get_llm_prompt($user_input) {
    return <<<PROMPT
# è§’è‰²å’Œç›®æ ‡
æ‚¨æ˜¯ä¸€åå¯Œæœ‰åˆ›é€ åŠ›çš„ç¯å…‰è®¾è®¡å¸ˆã€‚æ ¹æ®ç”¨æˆ·æè¿°,ç”Ÿæˆé¢œè‰²æ–¹æ¡ˆã€‚

# å†³ç­–å±‚çº§
1. **å®‰å…¨è‡³ä¸Š**: æ¶‰åŠè¡Œè½¦å®‰å…¨/å¥åº·ä¼˜å…ˆç”Ÿæˆè­¦ç¤ºè‰²
2. **ç”¨æˆ·æ„å›¾**: ç”¨æˆ·æ˜ç¡®æŒ‡å®šé¢œè‰²ä¼˜å…ˆ
3. **æ¨æ–­**: å…¶æ¬¡æ‰æ ¹æ®ç¯å¢ƒæ¨æ–­

# è¾“å‡ºæ ¼å¼ (JSON Only)
{
  "theme": "ç®€çŸ­ä¸­æ–‡æ¦‚æ‹¬",
  "color_count_suggestion": <1-3>,
  "candidate_colors": [
    {"name": "English Name", "rgb": [R, G, B]},
    ...
  ],
  "reason": "ç®€çŸ­ä¸­æ–‡è§£é‡Š"
}

# é…è‰²è§„åˆ™
1. ç¬¬ä¸€é¢œè‰²å¿…é¡»æœ€æ ¸å¿ƒ
2. é¢œè‰²é²œè‰³
3. é¿å…ææš—è‰²

# ç”¨æˆ·æŒ‡ä»¤
{$user_input}
PROMPT;
}
```

---

##  é¡¹ç›®ç»“æ„

```
Ambient-Light-Agent/
â”œâ”€â”€ index.php           # ä¸»ç¨‹åº (åç«¯ + å‰ç«¯)
â”œâ”€â”€ data/               # å†å²è®°å½•å­˜å‚¨ç›®å½•
â”‚   â””â”€â”€ *.json         # æ—¶é—´æˆ³å‘½åçš„é…è‰²è®°å½•
â”œâ”€â”€ README.md          # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ examples/          # ç¤ºä¾‹ä»£ç  (å¯é€‰)
    â””â”€â”€ esp32_client.ino
```

---

## âš™ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰é¢œè‰²ç­›é€‰é˜ˆå€¼

ç¼–è¾‘ `get_validation_status()` å‡½æ•°:

```php
function get_validation_status($rgb) {
    list($r, $g, $b) = $rgb;
    $max_val = max($r, $g, $b);
    $min_val = min($r, $g, $b);
    
    // è°ƒæ•´è¿™é‡Œçš„é˜ˆå€¼
    if ($max_val < 100) return ['valid' => false, 'reason' => 'äº®åº¦ä¸è¶³'];
    
    $saturation = ($max_val - $min_val) / $max_val;
    if ($saturation < 0.4) return ['valid' => false, 'reason' => "é¥±å’Œåº¦è¿‡ä½"];
    
    return ['valid' => true, 'reason' => null];
}
```

### ä¿®æ”¹é¢œè‰²å·®å¼‚æ€§é˜ˆå€¼

ç¼–è¾‘ `process_and_select_colors()` å‡½æ•°ä¸­çš„è·ç¦»åˆ¤æ–­:

```php
if ($best_candidate && $max_min_distance > 80) { // æ”¹ä¸º 60 é™ä½è¦æ±‚
    $final_selection[] = $best_candidate;
    ...
}
```

---
